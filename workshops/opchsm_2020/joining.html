---
layout: presentation
title: "Joining data"
---

<section>
  <h2>Joining data</h2>
  <p>May 2020</p>
  <small><p>This presentation was tailored to meet the needs of the 
            Office of Primary Care and Health Systems Management 
            and may not cover all aspects of joining data.</p></small>
</section>

<section>
    <h2>Learning Objectives</h2>
    <ul>
        <li>Join databases using:</li>
        <ul>
          <li>inner join</li>
          <li>outer join</li>
          <li>left join</li>
          <li>right join</li>
          <li>anti-join</li>
        </ul>
    </ul>
</section>

<section>
    <h2>Relational database definition</h2>
    <p>Collection of datasets that are combined using keys.<br />
       This structure reduces the need for duplication.</p>
  <p>Note: This is a temporary placeholder. Slides are very incomplete.</p>
    <div class="left">
    </div>
    <div class="right">
    </div>
</section>

<section>
    <h2>Relational database structure</h2>
    
    <table class="table table-striped table-hover table-condensed table-responsive" 
           style="width: auto !important; float: left; margin-right: 10px; font-size:75%;"
           border="1">
        <caption>Pet-level data</caption>
        <thead>
            <tr>
                <th style="text-align:center;">pet_name</th>
                <th style="text-align:center;">pet_type</th>
                <th style="text-align:center;">child_key</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td style="text-align:center;">Qua</td>
                <td style="text-align:center;">cat</td>
                <td style="text-align:center;">2</td>
            </tr>
            <tr>
                <td style="text-align:center;">Ray</td>
                <td style="text-align:center;">iguana</td>
                <td style="text-align:center;">3</td>
            </tr>
            <tr>
                <td style="text-align:center;">Sam</td>
                <td style="text-align:center;">dog</td>
                <td style="text-align:center;">3</td>
            </tr>
            <tr>
                <td style="text-align:center;">Tea</td>
                <td style="text-align:center;">cat</td>
                <td style="text-align:center;">1</td>
            </tr>
            <tr>
                <td style="text-align:center;">Urn</td>
                <td style="text-align:center;">cat</td>
                <td style="text-align:center;">1</td>
            </tr>
        </tbody>
    </table>
    <table class="table table-striped table-hover table-condensed table-responsive" 
           style="width: auto !important; margin-right: 0; margin-left: auto; font-size:75%;"
           border="1">
        <caption>Child-level data</caption>
        <thead>
            <tr>
                <th style="text-align:center;">child_key</th>
                <th style="text-align:center;">child_name</th>
                <th style="text-align:center;">child_age</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td style="text-align:center;">1</td>
                <td style="text-align:center;">Amy</td>
                <td style="text-align:center;">8</td>
            </tr>
            <tr>
                <td style="text-align:center;">2</td>
                <td style="text-align:center;">Ben</td>
                <td style="text-align:center;">10</td>
            </tr>
            <tr>
                <td style="text-align:center;">3</td>
                <td style="text-align:center;">Cam</td>
                <td style="text-align:center;">7</td>
            </tr>
        </tbody>
    </table>
</section>

<section>
    <h2>Merged dataset structure</h2>
    <table class="table table-striped table-hover table-condensed table-responsive" 
           style="width: auto !important; margin-left: auto; margin-right: auto; font-size:75%;"
           border="1">
        <caption>Child and pet-level data</caption>
        <thead>
            <tr>
                <th style="text-align:center;">pet_name</th>
                <th style="text-align:center;">pet_type</th>
                <th style="text-align:center;">child_key</th>
                <th style="text-align:center;">child_name</th>
                <th style="text-align:center;">child_age</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td style="text-align:center;">Qua</td>
                <td style="text-align:center;">cat</td>
                <td style="text-align:center;">2</td>
                <td style="text-align:center;">Ben</td>
                <td style="text-align:center;">10</td>
            </tr>
            <tr>
                <td style="text-align:center;">Ray</td>
                <td style="text-align:center;">iguana</td>
                <td style="text-align:center;">3</td>
                <td style="text-align:center;">Cam</td>
                <td style="text-align:center;">7</td>
            </tr>
            <tr>
                <td style="text-align:center;">Sam</td>
                <td style="text-align:center;">dog</td>
                <td style="text-align:center;">3</td>
                <td style="text-align:center;">Cam</td>
                <td style="text-align:center;">7</td>
            </tr>
            <tr>
                <td style="text-align:center;">Tea</td>
                <td style="text-align:center;">cat</td>
                <td style="text-align:center;">1</td>
                <td style="text-align:center;">Amy</td>
                <td style="text-align:center;">8</td>
            </tr>
            <tr>
                <td style="text-align:center;">Urn</td>
                <td style="text-align:center;">cat</td>
                <td style="text-align:center;">1</td>
                <td style="text-align:center;">Amy</td>
                <td style="text-align:center;">8</td>
            </tr>
        </tbody>
    </table>
    
    <aside class="notes">
You may need to rename or select variables pre-emptively to avoid confusion. 
	  </aside>
</section>


<section>
    <h2>Code for merging datasets</h2>
    <div class="left">
        <p>These functions merge on a key.</p>
        
        <ul>
            <li>left_join()</li>
            <li>right_join()</li>
            <li>full_join()</li>
            <li>inner_join()</li>
            <li>anti_join()</li>
        </ul>
    </div>
    <div class="right">
         <img src="{{site.baseurl}}/public/img/joinexamples-anti.png" 
              width="80%" alt="Join illustrations">
    </div>
</section>

<section>
  <section>
    <h2>Left joining</h2>
    <table class="table table-striped table-hover table-condensed table-responsive" 
       style="width: auto !important; float: left; margin-right: 10px; font-size:75%;"
       border="1">
        <caption>Musician</caption>
        <thead>
            <tr>
                <th style="text-align:center;">name</th>
                <th style="text-align:center;">band</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td style="text-align:center;">Mick</td>
                <td style="text-align:center;">Stones</td>
            </tr>
            <tr>
                <td style="text-align:center;">John</td>
                <td style="text-align:center;">Beatles</td>
            </tr>
            <tr>
                <td style="text-align:center;">Paul</td>
                <td style="text-align:center;">Beatles</td>
            </tr>
        </tbody>
    </table>
    <table class="table table-striped table-hover table-condensed table-responsive" 
           style="width: auto !important; margin-right: 0; margin-left: auto; font-size:75%;"
           border="1">
        <caption>Instrument</caption>
        <thead>
            <tr>
                <th style="text-align:center;">name</th>
                <th style="text-align:center;">plays</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td style="text-align:center;">John</td>
                <td style="text-align:center;">guitar</td>
            </tr>
            <tr>
                <td style="text-align:center;">Paul</td>
                <td style="text-align:center;">bass</td>
            </tr>
            <tr>
                <td style="text-align:center;">Keith</td>
                <td style="text-align:center;">guitar</td>
            </tr>
        </tbody>
    </table>
<pre><code class="r">
band_members %>% left_join(band_instruments, by = "name") 

</code></pre>
    <p>Click down for the joined table.</p>
  </section>
  <section>
    <h2>Left joined table</h2>
    <table class="table table-striped table-hover table-condensed table-responsive" 
       style="width: auto !important; margin-left: auto; margin-right: auto; font-size:75%;"
       border="1">
        <caption>Left joined table</caption>
        <thead>
            <tr>
                <th style="text-align:center;">name</th>
                <th style="text-align:center;">band</th>
                <th style="text-align:center;">plays</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td style="text-align:center;">Mick</td>
                <td style="text-align:center;">Stones</td>
                <td style="text-align:center;">NA</td>
            </tr>
            <tr>
                <td style="text-align:center;">John</td>
                <td style="text-align:center;">Beatles</td>
                <td style="text-align:center;">guitar</td>
            </tr>
            <tr>
                <td style="text-align:center;">Paul</td>
                <td style="text-align:center;">Beatles</td>
                <td style="text-align:center;">bass</td>
            </tr>
        </tbody>
    </table>
  </section>
</section>

<section>
  <h2>Practice: Left joining</h2>
  <p>Left join the pets and kids datasets from the Excel file in your 
     project. See <a href="">Importing and exporting data</a> for 
     instructions.</p>
  <pre><code class="fragment r">
pets %>% left_join(kids, by = "child_key")

  </code></pre>
</section>



<section>
  <section>
    <h2>Right joining</h2>
    <table class="table table-striped table-hover table-condensed table-responsive" 
       style="width: auto !important; float: left; margin-right: 10px; font-size:75%;"
       border="1">
        <caption>Musician</caption>
        <thead>
            <tr>
                <th style="text-align:center;">name</th>
                <th style="text-align:center;">band</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td style="text-align:center;">Mick</td>
                <td style="text-align:center;">Stones</td>
            </tr>
            <tr>
                <td style="text-align:center;">John</td>
                <td style="text-align:center;">Beatles</td>
            </tr>
            <tr>
                <td style="text-align:center;">Paul</td>
                <td style="text-align:center;">Beatles</td>
            </tr>
        </tbody>
    </table>
    <table class="table table-striped table-hover table-condensed table-responsive" 
           style="width: auto !important; margin-right: 0; margin-left: auto; font-size:75%;"
           border="1">
        <caption>Instrument</caption>
        <thead>
            <tr>
                <th style="text-align:center;">name</th>
                <th style="text-align:center;">plays</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td style="text-align:center;">John</td>
                <td style="text-align:center;">guitar</td>
            </tr>
            <tr>
                <td style="text-align:center;">Paul</td>
                <td style="text-align:center;">bass</td>
            </tr>
            <tr>
                <td style="text-align:center;">Keith</td>
                <td style="text-align:center;">guitar</td>
            </tr>
        </tbody>
    </table>
<pre><code class="r">
band_members %>% right_join(band_instruments, by = "name") 

</code></pre>
    <p>Click down for the joined table.</p>
  </section>
  <section>
    <h2>Right joined table</h2>
    <table class="table table-striped table-hover table-condensed table-responsive" 
       style="width: auto !important; margin-left: auto; margin-right: auto; font-size:75%;"
       border="1">
        <caption>Right joined table</caption>
        <thead>
            <tr>
                <th style="text-align:center;">name</th>
                <th style="text-align:center;">band</th>
                <th style="text-align:center;">plays</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td style="text-align:center;">John</td>
                <td style="text-align:center;">Beatles</td>
                <td style="text-align:center;">guitar</td>
            </tr>
            <tr>
                <td style="text-align:center;">Paul</td>
                <td style="text-align:center;">Beatles</td>
                <td style="text-align:center;">bass</td>
            </tr>
            <tr>
                <td style="text-align:center;">Keith</td>
                <td style="text-align:center;">NA</td>
                <td style="text-align:center;">guitar</td>
            </tr>
        </tbody>
    </table>
  </section>
</section>

<section>
  <h2>Practice: Left joining</h2>
  <p>Right join the pets and kids datasets.</p>
  <pre><code class="fragment r">
pets %>% right_join(kids, by = "child_key")

  </code></pre>
</section>


<section>
  <section>
    <h2>Full (Outer) joining</h2>
    <table class="table table-striped table-hover table-condensed table-responsive" 
       style="width: auto !important; float: left; margin-right: 10px; font-size:75%;"
       border="1">
        <caption>Musician</caption>
        <thead>
            <tr>
                <th style="text-align:center;">name</th>
                <th style="text-align:center;">band</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td style="text-align:center;">Mick</td>
                <td style="text-align:center;">Stones</td>
            </tr>
            <tr>
                <td style="text-align:center;">John</td>
                <td style="text-align:center;">Beatles</td>
            </tr>
            <tr>
                <td style="text-align:center;">Paul</td>
                <td style="text-align:center;">Beatles</td>
            </tr>
        </tbody>
    </table>
    <table class="table table-striped table-hover table-condensed table-responsive" 
           style="width: auto !important; margin-right: 0; margin-left: auto; font-size:75%;"
           border="1">
        <caption>Instrument</caption>
        <thead>
            <tr>
                <th style="text-align:center;">name</th>
                <th style="text-align:center;">plays</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td style="text-align:center;">John</td>
                <td style="text-align:center;">guitar</td>
            </tr>
            <tr>
                <td style="text-align:center;">Paul</td>
                <td style="text-align:center;">bass</td>
            </tr>
            <tr>
                <td style="text-align:center;">Keith</td>
                <td style="text-align:center;">guitar</td>
            </tr>
        </tbody>
    </table>
<pre><code class="r">
band_members %>% full_join(band_instruments, by = "name") 

</code></pre>
    <p>Click down for the joined table.</p>
  </section>
  <section>
    <h2>Full joined table</h2>
    <table class="table table-striped table-hover table-condensed table-responsive" 
       style="width: auto !important; margin-left: auto; margin-right: auto; font-size:75%;"
       border="1">
        <caption>Full joined table</caption>
        <thead>
            <tr>
                <th style="text-align:center;">name</th>
                <th style="text-align:center;">band</th>
                <th style="text-align:center;">plays</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td style="text-align:center;">Mick</td>
                <td style="text-align:center;">Stones</td>
                <td style="text-align:center;">NA</td>
            </tr>
            <tr>
                <td style="text-align:center;">John</td>
                <td style="text-align:center;">Beatles</td>
                <td style="text-align:center;">guitar</td>
            </tr>
            <tr>
                <td style="text-align:center;">Paul</td>
                <td style="text-align:center;">Beatles</td>
                <td style="text-align:center;">bass</td>
            </tr>
            <tr>
                <td style="text-align:center;">Keith</td>
                <td style="text-align:center;">NA</td>
                <td style="text-align:center;">guitar</td>
            </tr>
        </tbody>
    </table>
  </section>
</section>

<section>
  <h2>Practice: Full joining</h2>
  <p>Full join the pets and kids datasets.</p>
  <pre><code class="fragment r">
pets %>% full_join(kids, by = "child_key")

  </code></pre>
</section>



<section>
  <section>
    <h2>Inner joining</h2>
    <table class="table table-striped table-hover table-condensed table-responsive" 
       style="width: auto !important; float: left; margin-right: 10px; font-size:75%;"
       border="1">
        <caption>Musician</caption>
        <thead>
            <tr>
                <th style="text-align:center;">name</th>
                <th style="text-align:center;">band</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td style="text-align:center;">Mick</td>
                <td style="text-align:center;">Stones</td>
            </tr>
            <tr>
                <td style="text-align:center;">John</td>
                <td style="text-align:center;">Beatles</td>
            </tr>
            <tr>
                <td style="text-align:center;">Paul</td>
                <td style="text-align:center;">Beatles</td>
            </tr>
        </tbody>
    </table>
    <table class="table table-striped table-hover table-condensed table-responsive" 
           style="width: auto !important; margin-right: 0; margin-left: auto; font-size:75%;"
           border="1">
        <caption>Instrument</caption>
        <thead>
            <tr>
                <th style="text-align:center;">name</th>
                <th style="text-align:center;">plays</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td style="text-align:center;">John</td>
                <td style="text-align:center;">guitar</td>
            </tr>
            <tr>
                <td style="text-align:center;">Paul</td>
                <td style="text-align:center;">bass</td>
            </tr>
            <tr>
                <td style="text-align:center;">Keith</td>
                <td style="text-align:center;">guitar</td>
            </tr>
        </tbody>
    </table>
<pre><code class="r">
band_members %>% inner_join(band_instruments, by = "name") 

</code></pre>
    <p>Click down for the joined table.</p>
  </section>
  <section>
    <h2>Inner joined table</h2>
    <table class="table table-striped table-hover table-condensed table-responsive" 
       style="width: auto !important; margin-left: auto; margin-right: auto; font-size:75%;"
       border="1">
        <caption>Inner joined table</caption>
        <thead>
            <tr>
                <th style="text-align:center;">name</th>
                <th style="text-align:center;">band</th>
                <th style="text-align:center;">plays</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td style="text-align:center;">John</td>
                <td style="text-align:center;">Beatles</td>
                <td style="text-align:center;">guitar</td>
            </tr>
            <tr>
                <td style="text-align:center;">Paul</td>
                <td style="text-align:center;">Beatles</td>
                <td style="text-align:center;">bass</td>
            </tr>
        </tbody>
    </table>
  </section>
</section>

<section>
  <h2>Practice: Inner joining</h2>
  <p>Inner join the pets and kids datasets.</p>
  <pre><code class="fragment r">
pets %>% inner_join(kids, by = "child_key")

  </code></pre>
</section>



<section>
  <section>
    <h2>Anti joining</h2>
    <p>This function returns a partial (left) anti-join. For a full anti-join, run a full outer join, then filter on missings.</p>
    <table class="table table-striped table-hover table-condensed table-responsive" 
       style="width: auto !important; float: left; margin-right: 10px; font-size:75%;"
       border="1">
        <caption>Musician</caption>
        <thead>
            <tr>
                <th style="text-align:center;">name</th>
                <th style="text-align:center;">band</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td style="text-align:center;">Mick</td>
                <td style="text-align:center;">Stones</td>
            </tr>
            <tr>
                <td style="text-align:center;">John</td>
                <td style="text-align:center;">Beatles</td>
            </tr>
            <tr>
                <td style="text-align:center;">Paul</td>
                <td style="text-align:center;">Beatles</td>
            </tr>
        </tbody>
    </table>
    <table class="table table-striped table-hover table-condensed table-responsive" 
           style="width: auto !important; margin-right: 0; margin-left: auto; font-size:75%;"
           border="1">
        <caption>Instrument</caption>
        <thead>
            <tr>
                <th style="text-align:center;">name</th>
                <th style="text-align:center;">plays</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td style="text-align:center;">John</td>
                <td style="text-align:center;">guitar</td>
            </tr>
            <tr>
                <td style="text-align:center;">Paul</td>
                <td style="text-align:center;">bass</td>
            </tr>
            <tr>
                <td style="text-align:center;">Keith</td>
                <td style="text-align:center;">guitar</td>
            </tr>
        </tbody>
    </table>
<pre><code class="r">
band_members %>% anti_join(band_instruments, by = "name") 

</code></pre>
    <p>Click down for the joined table.</p>
  </section>
  <section>
    <h2>Anti joined table</h2>
    <p>Note that here, the variable <i>plays</i> is excluded and Keith, 
       from the instruments dataset, was left out.</p>
    <table class="table table-striped table-hover table-condensed table-responsive" 
       style="width: auto !important; margin-left: auto; margin-right: auto; font-size:75%;"
       border="1">
        <caption>Anti joined table</caption>
        <thead>
            <tr>
                <th style="text-align:center;">name</th>
                <th style="text-align:center;">band</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td style="text-align:center;">Mick</td>
                <td style="text-align:center;">Stones</td>
            </tr>
        </tbody>
    </table>
    <p>To return Keith instead of Mick, switch the datasets.</p>
<pre><code class="r">
band_instruments %>% anti_join(band_members, by = "name") 

</code></pre>
  </section>
</section>

<section>
  <h2>Practice: Anti joining</h2>
  <p>Anti join the pets and kids datasets. Do this for each dataset.</p>
  <pre><code class="fragment r">
pets %>% inner_join(kids, by = "child_key")

  </code></pre>
</section>

<section>
  <h2>Questions?</h2>
  <img src="http://3.bp.blogspot.com/-3neBa4Df2jg/VKDESZ4svdI/AAAAAAAAGYQ/ulXSX172Pts/s1600/jangbricks-q-a.jpg" alt="Q & A" width="30%">
</section>

